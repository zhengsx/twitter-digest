# Twitter AI 日报 - 需求文档

## 🎯 原始需求

### 核心目标
为 sx 生成每日 Twitter AI 领域信息摘要，追踪 @xxcc48764 关注的 KOL 动态。

### 功能需求

#### 1. 关注列表同步
- 爬取 Twitter 用户 **@xxcc48764** 的所有关注列表
- 每天检查关注列表是否有更新（新增/取消关注）
- 动态维护用户列表，无需手动更新

#### 2. 推文爬取
- 爬取关注列表中所有用户的最新推文
- 时间范围：**过去 24 小时内**
- 增量模式：避免重复处理已读推文

#### 3. AI 日报生成
- 使用 AI 分析和总结推文内容
- **关注重点**：
  - 💡 Insights（洞见）
  - 🎯 观点和立场
  - 📊 信息和数据
  - 🔧 技术细节
  - 📈 趋势预判
  - 其他有潜在价值的内容

#### 4. 日报格式要求
- 清晰的结构和分类
- **必须附上原文链接**（便于二次查看和查验）
- 支持 PDF 输出

---

## 📋 当前实现状态

### ✅ 已实现
- [x] 使用 Jina Reader API 爬取推文
- [x] 24h 时间过滤（Snowflake ID 硬校验 + timeStr 解析兜底）
- [x] tweetId 增量模式（避免重复）
- [x] Markdown/PDF 报告生成
- [x] 原文链接附加
- [x] 过滤日志（输出被过滤的旧推文：用户名 + 时间 + 原因）

### ✅ 已修复
- [x] **旧新闻混入日报** — 无法解析时间默认丢弃 + Snowflake ID 硬性校验（修复日期: 2026-02-09）
- [x] **用户数只爬到 26 个** — 移除过时 `following-list.json`，所有入口统一读取 `config.followingUsers`（修复日期: 2026-02-09）

### ❌ 未实现 / 有问题
- [ ] **关注列表动态获取** — 当前是硬编码的用户列表
- [ ] **关注列表变更检测** — 未实现
- [ ] **Jina 缓存问题** — 返回旧数据，没有爬到最新推文
- [ ] **AI 深度分析** — 当前只是简单整理，缺乏 insights 提取

### 🔧 技术问题
1. **Jina Reader 缓存严重** — 即使加 `X-No-Cache` header 有时也返回旧数据
2. **Twitter 页面动态加载** — 需要足够的 timeout 才能获取完整内容
3. **关注列表爬取** — Twitter 的 following 页面可能需要登录或特殊处理
4. **置顶/旧推文混入** — 已通过 Snowflake ID 硬过滤修复（2026-02-09）
5. **信源数量异常偏少** — 已移除过时 following-list.json 并统一走配置修复（2026-02-09）

---

## 🛠️ 改进计划

### Phase 1: 修复爬取问题
1. Jina 请求添加 `X-No-Cache: true` + `X-Timeout: 30`
2. 验证返回数据的时效性
3. 添加数据校验（检测是否获取到最新推文）

### Phase 2: 动态关注列表
1. 爬取 @xxcc48764 的 following 列表
2. 存储并比对变更
3. 自动更新用户列表

### Phase 3: AI 分析增强
1. 使用 LLM 提取 insights 和关键观点
2. 分类整理（技术/趋势/观点/新闻）
3. 生成结构化日报

---

## 📁 项目结构

```
twitter-digest/
├── REQUIREMENTS.md      # 本文档
├── src/
│   ├── fetch-and-generate-v2.js  # 主程序
│   ├── tweet-state.js   # 增量状态管理
│   └── tweet-time.js    # Snowflake ID 时间工具
├── data/
│   ├── tweet-state.json # 已处理推文状态
│   └── tweets-*.json    # 原始数据
└── reports/
    └── twitter-daily-report-*.md/pdf
```

---

## 🔑 关键账号

- **信源账号**: @xxcc48764（sx 的 Twitter，关注列表是信源）
- **Jina API Key**: 见 TOOLS.md

---

*文档创建: 2026-02-05*
*最后更新: 2026-02-09*
